<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="diary">


<select id="getDiaryList" parameterType="hashmap" resultType="hashmap">
	SELECT BASIC.DIARY_NO
		  ,BASIC.WRITER
		  ,BASIC.SUBJECT
		  ,BASIC.DIARY
		  ,BASIC.REG_DT
	  FROM DIARY BASIC
  ORDER BY REG_DT 
</select>

<update id="saveDiary" parameterType="hashmap">
	MERGE INTO DIARY TARGET
	     USING (SELECT  '${DIARY_NO}' AS DIARY_NO
	                   ,'${WRITER  }' AS WRITER
	                   ,'${SUBJECT }' AS SUBJECT
	                   ,'${DIARY   }' AS DIARY
	                   ,SYSDATE     AS REG_DT
	     		  FROM DUAL
	     		) SOURCE
	        ON (TARGET.DIARY_NO = SOURCE.DIARY_NO)
    WHEN MATCHED THEN
        UPDATE
           SET TARGET.WRITER  = SOURCE.WRITER,
               TARGET.SUBJECT = SOURCE.SUBJECT,
               TARGET.DIARY   = SOURCE.DIARY,
               TARGET.REG_DT  = SOURCE.REG_DT
    WHEN NOT MATCHED THEN
        INSERT (TARGET.DIARY_NO,  TARGET.WRITER, TARGET.SUBJECT, TARGET.DIARY, TARGET.REG_DT)
        VALUES (COMM_SEQ.NEXTVAL, SOURCE.WRITER, SOURCE.SUBJECT, SOURCE.DIARY, SOURCE.REG_DT)
</update>

</mapper>